version: '3.7'

services:
  mybootnode:
    hostname: mybootnode
    env_file:
      - .env
    build:
      context: .
      args:
        - ACCOUNT_PASSWORD=${ACCOUNT_PASSWORD}
    command: --nodekeyhex="c3ddeffce8d5c5d0059cb854ab2a16175343b9261798652cd2b1c8bad0592d96" --nodiscover --ipcdisable --networkid=${NETWORK_ID} --netrestrict="172.16.254.0/28"
    networks:
      priv-eth-net:  

  miner-1:
    hostname: miner-1
    env_file:
      - .env
    build:
      context: .
      args:
        - ACCOUNT_PASSWORD=${ACCOUNT_PASSWORD}
    command: --bootnodes="enode://b0acfb9aead5e541f32eef39d60597c74067d71bcf18cc9cdafe66a8289df74859c99f76f5d58da2dee8ce5484e31c4861af3219ab126b8c730625292d588194@mybootnode:30303" --mine --miner.threads=1 --networkid=${NETWORK_ID} --netrestrict="172.16.254.0/28"
    networks:
      priv-eth-net:

  miner-2:
    hostname: miner-1
    env_file:
      - .env
    build:
      context: .
      args:
        - ACCOUNT_PASSWORD=${ACCOUNT_PASSWORD}
    command: --bootnodes="enode://2af3694fe119c1806da4cedee31904f77780a407a398b3d689d09a46a2269652f6899a7a88a614bde944a9c33d29b6e211ed38c3a956c8358e4198d5b0e7950b@mybootnode:30303" --mine --miner.threads=1 --networkid=${NETWORK_ID} --netrestrict="172.16.254.0/28"
    networks:
      priv-eth-net:

  networks:
    priv-eth-net:
      driver: bridge
      ipam:
        config:
          - subnet: 172.16.254.0/28